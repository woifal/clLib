<html>
<head>
		<script type="text/javascript" src="js/clLib.js"></script>
		<script type="text/javascript" src="js/clLib.gradeConfig.js"></script>
		<script type="text/javascript" src="js/clLib.localStorage.js"></script>
		<script type="text/javascript" src="js/clLib.localStorage.indexes.js"></script>
		
		<script type="text/javascript" src="sampledata/routeLogSample.js"></script>
		<script type="text/javascript" src="sampledata/routeSample_big.js"></script>
		
		<script type="text/javascript" src="http://codeorigin.jquery.com/jquery-1.8.2.js"></script>
<!--        <script type="text/javascript" src="http://codeorigin.jquery.com/mobile/1.3.0/jquery.mobile-1.3.0.js"></script>
-->
</head>
    
<body>
	<input style="width: 300px" id="whereClauseStr" value=""/>
	<input style="width: 200px" id="distinctColumn" value=""/>
	<input id="testQuery" type="button">
	
	<div id="foo">xx</div>
	<script>
	"use strict";
	
	
	
//$( document ).live("pagecreate", function() {
(function(){
   console.log("start");
	
	
	var profiledFnCall = function(iterations, aFunc) {
		var totalDuration = 0;
		for(var i = 0; i < iterations; i++) {
			var startDate = +new Date();
			aFunc();
			var endDate = +new Date();
			totalDuration += (endDate - startDate);
		}
		return totalDuration / iterations;
	};
	
	//alert(JSON.stringify(routeLogSample));
	//clLib.calculateScore(routeLogSample);
	
	//clLib.localStorage.initStorage("routeLogStorage", routeLogSample);
	//console.profile();
	console.log("init storage start");
	alert(profiledFnCall(1, function() { clLib.localStorage.initStorage("routeStorage", routeSample); }));
	console.log("init storage end");
	//console.profileEnd();
	
	var distinctColumn, whereStr = 
			clLib.getRoutesWhere("French", "6a+", "Climb on Marswiese", "Turm-C");
	$("#whereClauseStr").val(whereStr);
	$("#distinctColumn").val("Colour");
	//alert("built where clause " + tojson(JSON.parse(whereStr)));
	$("#testQuery").click(function() {
		whereStr = JSON.parse($("#whereClauseStr").val());
		distinctColumn = $("#distinctColumn").val();
		var results = {}, distincts = {};
		
		var avgDur = profiledFnCall(10, function() { 
			distincts = clLib.localStorage.getDistinct("routes", whereStr, distinctColumn, "routeStorage");
		});
		printi("avg duration for distincts: " + avgDur);
		
		var avgDur = profiledFnCall(10, function() { 
			results = clLib.localStorage.getEntities("routes", whereStr, "routeStorage");
		});
		printi("avg duration for results: " + avgDur);
			printi("got no of results:" + Object.keys(results).length);
			printi("got no of distinct Colours:" + Object.keys(distincts).length);
			printi("got distinct Colours:" + JSON.stringify(distincts.sort()));
			//alert(Object.keys(results).length);
	});
	
	var printi = function(text) {
		$("<p>").html(text).appendTo("#foo");
	
	};
	
	console.log("end");
})(jQuery);
//   });		

   </script>
    
</body>
</html>